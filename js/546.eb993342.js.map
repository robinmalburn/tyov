{"version":3,"file":"js/546.eb993342.js","mappings":"sHAAA,cACIA,YAAa,8DACbC,kBAAmB,EACnBC,OAAAA,CAAQC,GACJ,MAAMC,EAAY,CAAC,EAEnBD,EAAKE,QAAQC,SAASC,IAClBA,EAAMC,SAASF,SAASG,SACSC,IAAzBN,EAAUK,EAAOE,MACjBP,EAAUK,EAAOE,IAAM,IAG3BP,EAAUK,EAAOE,IAAIC,KAAKL,EAAM,WAG7BA,EAAMC,QAAQ,IAIpBL,EAAKU,SACNV,EAAKU,OAAS,IAGlB,IAAIC,EAAMX,EAAKU,OA+Bf,OA7BAV,EAAKK,SAASF,SAASG,IASnB,QARwBC,IAApBD,EAAOM,iBACAN,EAAOM,cAGGL,IAAjBD,EAAOF,QACPE,EAAOF,MAAQ,SAGUG,IAAzBN,EAAUK,EAAOE,IAAmB,CACpC,IAAIJ,EAAQH,EAAUK,EAAOE,IAAI,GAE7BP,EAAUK,EAAOE,IAAIK,OAAS,IAAe,IAAVT,GACnCH,EAAUK,EAAOE,IAAIM,MAAMC,KACR,IAAXA,EAAEC,OACFZ,EAAQW,EACZ,IAIRT,EAAOF,MAAQA,EAAMI,EACzB,CAEAF,EAAOI,OAAOP,SAASc,GAAUA,EAAMX,OAASA,EAAOE,KACvDR,EAAKU,OAAOQ,OAAOP,EAAK,KAAML,EAAOI,QACrCC,GAAOL,EAAOI,OAAOG,cACdP,EAAOI,MAAM,IAGjBV,CACX,E","sources":["webpack://tyov/./src/migrations/20210501-decoupleMemoryEventDiaryStates.js"],"sourcesContent":["export default {\r\n    description: 'Decouples the nested state of memories, events and diaries.',\r\n    requiredSignature: 2,\r\n    migrate(data) {\r\n        const memoryMap = {};\r\n\r\n        data.diaries.forEach((diary) => {\r\n            diary.memories.forEach((memory) => {\r\n                if (memoryMap[memory.id] === undefined) {\r\n                    memoryMap[memory.id] = [];\r\n                }\r\n\r\n                memoryMap[memory.id].push(diary);\r\n            });\r\n\r\n            delete diary.memories;\r\n        });\r\n\r\n\r\n        if (!data.events) {\r\n            data.events = [];\r\n        }\r\n\r\n        let len = data.events;\r\n\r\n        data.memories.forEach((memory) => {\r\n            if (memory.diarised !== undefined) {\r\n                delete memory.diarised;\r\n            }\r\n\r\n            if (memory.diary === undefined) {\r\n                memory.diary = '';\r\n            }\r\n\r\n            if (memoryMap[memory.id] !== undefined) {\r\n                let diary = memoryMap[memory.id][0];\r\n\r\n                if (memoryMap[memory.id].length > 1 && diary === false) {\r\n                    memoryMap[memory.id].some((d) => {\r\n                        if (d.lost === false) {\r\n                            diary = d;\r\n                        }\r\n                    });\r\n                }\r\n\r\n                memory.diary = diary.id;\r\n            }\r\n\r\n            memory.events.forEach((event) => event.memory = memory.id);\r\n            data.events.splice(len, 0, ...memory.events);\r\n            len += memory.events.length;\r\n            delete memory.events;\r\n        });\r\n\r\n        return data;\r\n    }\r\n};"],"names":["description","requiredSignature","migrate","data","memoryMap","diaries","forEach","diary","memories","memory","undefined","id","push","events","len","diarised","length","some","d","lost","event","splice"],"sourceRoot":""}